#!/usr/bin/env bash
# Call stow with correct paths for dotfiles
#
# Should be able to run with `-R` to delete stale files, otherwise can do
# `find -L ~/.config -type l [-delete]` to find/remove stale links
#
# Usage: stow [-nv]

set -euo pipefail
IFS=$'\n\t'

main() {
  local dotfiles_root
  dotfiles_root="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
  local stowed_files_path="${dotfiles_root}/stowed-files"

  if [[ ! -d "${stowed_files_path}" ]]; then
    echo "Warning: stowed-files directory not found at ${stowed_files_path}, skipping stow"
    return 0
  fi

  # Purposefully allow word splitting on $@ to pass through flags
  # shellcheck disable=SC2046,SC2068
  stow --dir="${stowed_files_path}/" --target="$HOME" \
    $(ls "${stowed_files_path}") ${@}
}

main "${@}"
