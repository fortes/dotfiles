#!/usr/bin/env bash
# Install Claude Code from official distribution
#
# Usage: install_claude_code

set -euo pipefail
IFS=$'\n\t'

# shellcheck source=script/lib.sh
. "$(dirname "${BASH_SOURCE[0]}")/lib.sh"

install_claude_code() {
  # Once installed, claude auto-updates
  if command_exists claude; then
    return 0
  fi

  # Make sure pnpm is in the path, important for first run before all the right
  # env is set up
  if command_exists fnm; then
    eval "$(fnm env)"
  fi

  if ! command_exists pnpm; then
    >&2 echo "тип pnpm not installed"
    exit 1
  fi

  echo "Installing Claude Code..."
  pnpm dlx @anthropic-ai/claude-code install
  echo "Claude code installed!"
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  install_claude_code
fi
