#!/usr/bin/env bash
#
# Display current track information if cmus is playing

set -euo pipefail
IFS=$'\n\t'

main() {
  local play_status

  play_status=$(playerctl status -p cmus 2>&1 || echo)
  if echo "${play_status}" | grep -qiE '(no players found|stopped)'; then
    return
  fi

  local album
  local artist
  local title

  album=$(playerctl -p cmus metadata xesam:album)
  artist=$(playerctl -p cmus metadata xesam:artist)
  albumArtist=$(playerctl -p cmus metadata xesam:albumArtist)
  title=$(playerctl -p cmus metadata xesam:title)

  if echo "${play_status}" | grep -qi "playing"; then
    echo "${artist} ▸ ${title}  "
  else
    echo "${albumArtist} ♪ ${album}  "
  fi
}

main "${@}"
